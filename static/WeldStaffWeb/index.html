<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>舟山中远海运重工--质量管理--焊工软件</title>
    <link rel="stylesheet" type="text/css" href="js/easyui-1.5.3/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="js/easyui-1.5.3/themes/icon.css">
    <script type="text/javascript" src="js/easyui-1.5.3/jquery.min.js"></script>
    <script type="text/javascript" src="js/easyui-1.5.3/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="/WeldStaffWeb/weldstaff/config.js"></script>
    <script type="text/javascript" src="/WeldStaffWeb/weldstaff/messager.js"></script>
    <style type="text/css">
        body {
            width: 100%;
            height: 100%;
        }
        
        a {
            text-decoration: none;
            color: blue;
        }
        
        .title-top {
            margin-top: -10px;
            padding: 10px;
            height: 55px;
            background-color: #325B80;
            vertical-align: center;
        }
        
        .title-top img {
            width: 60px;
            height: 60px;
            float: left;
        }
        
        .title-top h2 {
            float: left;
            color: #fff;
            display: inline-block;
            margin-left: 10px;
        }
        
        .title-bottom {
            padding: 5px;
        }
        
        .footer {
            background-color: #325B80;
            color: #fff;
            display: block;
            width: 100%;
            height: 100%;
            text-align: center;
            font-size: 15px;
            line-height: 2;
        }
        
        span.tree-title:hover {
            cursor: pointer !important;
        }
        
        .mycontainer {
            width: 100%;
            border: none;
        }
    </style>
</head>

<body>
    <div class="easyui-layout" fit=true style="height:700px;">
        <div data-options="region:'north'" style="height:100px">
            <div class="title-top">
                <img src="../res/logo.png"></img>
                <h2 id="ver">舟山中远海运重工--质量管理--焊工软件</h2>
            </div>
            <div class="title-bottom">
                当前用户:<span id="user" style="font-weight: bold;"></span>&nbsp;
                <a href="userlogin.html">登陆</a> &nbsp;&nbsp; 今日:
                <span id='today' style="font-weight: bold;"></span>
            </div>
        </div>
        <div data-options="region:'south',split:true" style="height:50px;">
            <div class="footer">
                联系人:质量部管理室--杨嫚,联系电话:621365
            </div>
        </div>
        <div id="menu" data-options="region:'west',split:true" title="" style="width:220px;">
            <ul id="tt">
                <li>
                    <span>质量部</span>
                    <ul id='weldStaff'>
                        <li>
                            <span>焊工管理</span>
                            <ul id='weldStaffExam'>
                                <li>
                                    <span>焊工考试</span>
                                    <ul>
                                        <li id='t51'><span>考试申请</span></li>
                                        <li id='t52'><span>考试审核</span></li>
                                        <li id='t53'><span>结果评定</span></li>
                                        <li id='t55'><span>结果清单</span></li>
                                        <li id='t54'><span>合格率/参加率</span></li>
                                    </ul>
                                </li>
                                <li>
                                    <span>焊工信息</span>
                                    <ul>
                                        <li id='t61'><span>信息录入</span></li>
                                        <li id='t62'><span>CCS证书申请</span></li>
                                        <li id='t63'><span>焊工总清单</span></li>
                                        <li id='t64'><span>过期焊工清单</span></li>
                                        <li id='t65'><span>离厂焊工清单</span></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <ul id='manager'>
                        <li>
                            <span>管理员</span>
                            <ul>
                                <li id='t32'>
                                    <span>用户管理</span>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
        <div id="content" data-options="region:'center',title:'',iconCls:'icon-ok'">
        </div>
    </div>

</body>
<script type="text/javascript">
    var User = {}
    var ConfigParam = null;

    //加载初始化文件
    function loadConfigParam(cb) {
        typeof cb == 'function' && cb(ConfigParam)
    }

    $(function() {
        //检测用户
        //版本号
        $('#ver').text($('#ver').text() + " " + config.version)

        //加载初始化
        loadConfigParam(function() {
            function loadNew(src, isNew) {
                isNew = isNew || false;
                $("#content").empty();
                if (!isNew) {
                    $("#content").load(src);
                } else {
                    var cell = $("<iframe frameborder='0'> </iframe>");
                    cell.attr('src', "/" + src);
                    cell.addClass("mycontainer");
                    cell.css("height", $("#content").height());
                    var parent = $("#content");
                    parent.append(cell);
                }
            }

            config.userCheck(function(user) {
                User = user;
                $('#user').text(User.名 + "(" + User.英文名 + ")");
          
                //权限管理
                userAuth(function() {
                    //树形按钮设置
                    var sTemp1 = config.version
                    $('#tt').tree({
                        onClick: function(node) {
                            //console.log(node)
                           if (node.id == 't51') {
                                loadNew("WeldStaffWeb/wsinput.html?tt=" + sTemp1, true);
                            } else if (node.id == 't52') {
                                loadNew("WeldStaffWeb/wsconfirm.html?tt=" + sTemp1, true);
                            } else if (node.id == 't53') {
                                loadNew("WeldStaffWeb/wsfeedback.html?tt=" + sTemp1, true);
                            } else if (node.id == 't55') {
                                loadNew("WeldStaffWeb/wsresultlist.html?tt=" + sTemp1, true);
                            } else if (node.id == 't54') {
                                //loadNew("WeldStaffWeb/wshegelv.html?tt=" + sTemp1, true);
                            } else if (node.id == "t61") {
                                loadNew("WeldStaffWeb/wscuserinfo.html?tt=" + sTemp1, true);
                            } else if (node.id == "t62") {
                                loadNew("WeldStaffWeb/wscuserinfocss.html?tt=" + sTemp1, true);
                            } else if (node.id == "t63") {
                                loadNew("WeldStaffWeb/wscuserinfototal.html?tt=" + sTemp1, true);
                            } else if (node.id == "t64") {
                                loadNew("WeldStaffWeb/wscuserinfoguoqi.html?tt=" + sTemp1, true);
                            } else if (node.id == "t65") {
                                loadNew("WeldStaffWeb/wscuserinfolichang.html?tt=" + sTemp1, true);
                            } else if (node.id == "t32") {
                                loadNew("WeldStaffWeb/manageuser.html?tt=" + sTemp1, true);
                            }
                        }
                    });

                })
            });

        });


        //设置今日
        $('#today').text(new Date().Format("yyyy-MM-dd"))
    })

    //用户权限控制
    function userAuth(cb) {
        var cbuser = function(users) {
            var user = {}
            if (users.length == 1) {
                user = users[0]
            } else {
                user = User
            }
            if (user.职务 != '管理员') {
                $('#manager').remove();
                $('#weldStaff').remove();
            }
            if (user.职务 == '访客') {
                $('#dodform').remove();
                $('#mydform').remove();
            }
            if (user.职务 == '检验员') {
                $('#t12').remove();
            }
            cb()
        }

        filter = {
            "英文名": User.英文名
        }
        sfilter = JSON.stringify(filter)
        $.ajax({
            url: '/user/get?filter=' + sfilter,
            success: function(res, status) {
                typeof cbuser == 'function' && cbuser(res)
            },
            //调用出错执行的函数
            error: function() {
                //请求出错处理
                alert("用户读取失败")
            }
        });
    }
</script>

</html>